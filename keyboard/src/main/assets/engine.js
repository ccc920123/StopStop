(function(b,a){typeof exports==="object"&&typeof module!=="undefined"?module.exports=a():typeof define==="function"&&define.amd?define(a):(b.KeyboardEngine=a())}(this,(function(){var T={create:function(ar){var ap={};var ao=new Array();var aq=0;ap.next=function(at){if(aq<=ao.length){return(ao[(aq++)])(ap,at)}else{return ar}};ap.process=function(au){var at=ap.next(au);aq=0;return at};ap.reg=function(at){ao.push(at);return ap};return ap}};var S={create:function(){var ao={};var ap=new Array();ao.process=function(at,ar){var aq=at;ap.forEach(function(au){aq=au(aq,ar)});return aq};ao.reg=function(aq){ap.push(aq);return ao};return ao}};var N={_mcached:{},reg:function(at,ar,aq){if(aq!==undefined&&aq.constructor===Array){var ap=this._mcached;aq.forEach(function(au){ap[(ar+":"+au)]=at})}else{var ao=(aq===undefined?0:aq);this._mcached[(ar+":"+ao)]=at}},load:function(ap,ao){return this._mcached[(ap+":"+(ao===undefined?0:ao))]}};var ai={FULL:0,CIVIL:1,CIVIL_WJ:2};var F={GENERAL:0,FUN_DEL:1,FUN_OK:2};var an={UNKNOWN:-1,AUTO_DETECT:0,CIVIL:1,WUJING:2,WUJING_LOCAL:3,ARMY:4,NEW_ENERGY:5,EMBASSY:6,EMBASSY_NEW:7,AVIATION:8,nameOf:function(ao){switch(ao){case 1:return"UNKNOWN";case 0:return"AUTO_DETECT";case 1:return"CIVIL";case 2:return"WUJING";case 3:return"WUJING_LOCAL";case 4:return"ARMY";case 5:return"NEW_ENERGY";case 6:return"EMBASSY";case 7:return"EMBASSY_NEW";case 8:return"AVIATION";default:return"UNKNOWN"}},lenOf:function(ao){switch(ao){case 3:case 5:return 8;default:return 7}}};var y="京津晋冀蒙辽吉黑沪苏浙皖闽赣鲁豫鄂湘粤桂琼渝川贵云藏陕甘青宁新";var ag="QVKHBSLJNGCEZ";var D="ABCDEFGHJKLMNOPRSTUVXY";var ak="1234567890";var ae="QWERTYUPASDFGHJKLZXCVBNM";var ah=ak+ae;var ad="使";var s="港";var g="澳";var u="学";var c="警";var B="民";var k="航";var n=c+"挂领试超";var x="W";var I="J";var C="O";var aa="DF";var a="123";var X=a+aa;var O="QWERTYUIOP";var f="QWERTYUOP";var p="QWERTYUP";var j="ASDFGHJKL";var o="ZXCVBNM";var e=s+g;var W=ad+a;var ab="-";var al=ab+"+";function t(aq,ap,ao){return{text:aq,keyCode:ap===undefined?F.GENERAL:ap,enabled:ao===undefined?true:ao,isFunKey:ap===undefined?false:(ap!==F.GENERAL)}}function l(ao,ap){return t(ao.text,ao.keyCode,ap)}function m(aq){var ao=new Array();for(var ap=0;ap<aq.length;ap++){ao.push(t(aq[ap]))}return ao}function r(ao,aq,ap){return t(aq,ap,ao.enabled)}function L(ap,ao){return ap.indexOf(ao)>=0}function Z(ao){return L(y,ao)}function H(ao){if(ao.length===0){return an.AUTO_DETECT}else{var ap=ao.charAt(0);if(L(ag,ap)){return an.ARMY}else{if(ad===ap){return an.EMBASSY}else{if(B===ap){return an.AVIATION}else{if(L(a,ap)){return an.EMBASSY_NEW}else{if(x===ap){if(ao.length>=3&&Z(ao.charAt(2))){return an.WUJING_LOCAL}else{return an.WUJING}}else{if(Z(ap)){if(ao.length===8){if(/\W[A-Z][0-9DF][0-9A-Z]\d{3}[0-9DF]/.test(ao)){return an.NEW_ENERGY}else{return an.UNKNOWN}}else{return an.CIVIL}}else{return an.UNKNOWN}}}}}}}}var v={keyProvider:T.create({}),layoutProvider:T.create({}),mixiner:S.create()};var am="layout.c";var i="layout.w";var b="layout.w.f";var Y="layout.f";N.reg({row0:m(y.substr(0,9)),row1:m(y.substr(9,8)),row2:m(y.substr(17,8)),row3:m(y.substr(25,6)+al),},am,0);N.reg({row0:m(ak),row1:m(f+g),row2:m(j+s),row3:m(o+al),},am,1);N.reg({row0:m(ak),row1:m(p+e),row2:m(j+u),row3:m(o+al),},am,[2,3,4,5,6,7]);N.reg({row0:m(y.substr(0,9)),row1:m(y.substr(9,9)),row2:m(y.substr(18,8)),row3:m(y.substr(26,5)+x+al),},i,0);N.reg({row0:m(ak+y.substr(0,1)),row1:m(y.substr(1,11)),row2:m(y.substr(12,11)),row3:m(y.substr(22,8)+al),},i,2);N.reg({row0:m(ak+y.substr(0,1)),row1:m(y.substr(1,11)),row2:m(y.substr(12,10)),row3:m(y.substr(22,9)+ab),},b,2);N.reg({row0:m(y.substr(0,10)),row1:m(y.substr(10,10)),row2:m(y.substr(20,10)),row3:m(y.substr(30,1)+B+W+x+ag.substr(0,4)),row4:m(ag.substr(4,9)+ab)},Y,0);N.reg({row0:m(ak),row1:m(O),row2:m(j),row3:m(o+u+k),row4:m(e+n+ad+ab)},Y,1);N.reg({row0:m(ak),row1:m(O),row2:m(j),row3:m(o+u),row4:m(e+n+ad+ab)},Y,[2,3,4,5,6,7]);v.layoutProvider.reg(function(ap,ao){if(0===ao.index&&ao.keyboardType===ai.CIVIL_WJ){return N.load(i,0)}else{return ap.next(ao)}});v.layoutProvider.reg(function(ap,ao){if(2===ao.index&&ao.keyboardType!==ai.CIVIL&&(an.WUJING===ao.numberType||an.WUJING_LOCAL===ao.numberType)){if(ao.keyboardType===ai.FULL){return N.load(b,2)}else{return N.load(i,2)}}else{return ap.next(ao)}});v.layoutProvider.reg(function(ap,ao){if(ao.keyboardType===ai.FULL){return N.load(Y,ao.index)}else{return N.load(am,ao.index)}});var aj="keys.any";var w="keys.civil";var K="keys.army";var A="keys.wj";var Q="keys.aviation";var G="keys.embassy";var M="keys.embassy.zh";var J="keys.num";var z="keys.num.letters";var q="keys.O.police";var P="keys.num.df";var U="keys.hk.macao";var E="keys.postfix";N.reg(m(y+W+x+ag+B),aj);N.reg(m(ak),J);N.reg(m(ah),z);N.reg(m(ah+c),q);N.reg(m(ae+C),w,1);N.reg(m(D),K,1);N.reg(m(a),G,1);N.reg(m(I),A,1);N.reg(m(k),Q,1);N.reg(m(ak+y),A,2);N.reg(m(ak+aa),P);N.reg(m(e),U);N.reg(m(ah+n+u),E);N.reg(m(ad),M);v.keyProvider.reg(function(ap,ao){if(0===ao.index){return N.load(aj)}else{return ap.next(ao)}});v.keyProvider.reg(function(ap,ao){if(1===ao.index){switch(ao.numberType){case an.ARMY:return N.load(K,1);
case an.WUJING:case an.WUJING_LOCAL:return N.load(A,1);case an.AVIATION:return N.load(Q,1);case an.EMBASSY:return N.load(G,1);case an.EMBASSY_NEW:return N.load(J);default:return N.load(w,1)}}else{return ap.next(ao)}});v.keyProvider.reg(function(ap,ao){if(2===ao.index){switch(ao.numberType){case an.WUJING:case an.WUJING_LOCAL:return N.load(A,2);case an.EMBASSY:case an.EMBASSY_NEW:return N.load(J);case an.NEW_ENERGY:return N.load(P);default:return N.load(z)}}else{return ap.next(ao)}});v.keyProvider.reg(function(ap,ao){if(3===ao.index&&an.EMBASSY===ao.numberType){return N.load(J)}else{return ap.next(ao)}});v.keyProvider.reg(function(ap,ao){if((4===ao.index||5===ao.index)&&an.NEW_ENERGY===ao.numberType){return N.load(J)}else{return ap.next(ao)}});v.keyProvider.reg(function(ap,ao){if(6===ao.index){var at=ao.numberType;switch(ao.numberType){case an.NEW_ENERGY:return N.load(J);case an.ARMY:case an.EMBASSY:case an.WUJING:case an.AVIATION:case an.WUJING_LOCAL:return N.load(z);case an.EMBASSY_NEW:return N.load(M);default:var ar=ao.number.charAt(1);if("O"===ar){return N.load(q)}else{var aq=an.CIVIL===at&&"粤"===ao.number.charAt(0)&&"Z"===ar;if(aq){return N.load(U)}else{return N.load(E)}}}}return ap.next(ao)});v.keyProvider.reg(function(ap,ao){if(7===ao.index&&an.NEW_ENERGY===ao.numberType){return N.load(P)}return ap.next(ao)});v.keyProvider.reg(function(){return N.load(z)});function V(aq,ao){var ap=aq["row"+ao];return ap===undefined?[]:ap}function af(ap,ao,aq){ap["row"+ao]=V(ap,ao).map(aq)}function d(ao,ap){ao.numberType=ao.numberType;af(ao,0,ap);af(ao,1,ap);af(ao,2,ap);af(ao,3,ap);af(ao,4,ap);return ao}v.mixiner.reg(function(ap,ao){var aq=ao.keys.map(function(ar){return ar.text});return d(ap,function(ar){return l(ar,L(aq,ar.text))})});v.mixiner.reg(function(ap,ao){return d(ap,function(aq){var ar=aq.enabled;if(ar&&ao.index===0&&ap.numberType===an.NEW_ENERGY){ar=Z(aq.text)}return l(aq,ar)})});v.mixiner.reg(function(ao){return d(ao,function(ap){if("-"===ap.text){return r(ap,"",F.FUN_DEL)}else{if("+"===ap.text){return r(ap,"确定",F.FUN_OK)}else{return ap}}})});v.mixiner.reg(function(ao){return d(ao,function(ap){if(ap.keyCode===F.FUN_DEL){return l(ap,ao.numberLength!=0)}else{return ap}})});v.mixiner.reg(function(ao){return d(ao,function(ap){if(ap.keyCode===F.FUN_OK){return l(ap,ao.numberLength===ao.numberLimitLength)}else{return ap}})});v.mixiner.reg(function(ao){ao.keys=V(ao,0).concat(V(ao,1)).concat(V(ao,2)).concat(V(ao,3)).concat(V(ao,4));return ao});function R(ao){var ap=ao.constructor();for(var aq in ao){if(ao.hasOwnProperty(aq)){ap[aq]=ao[aq]}}return ap}function ac(au,ay,ax,aq){if(au===undefined||au<ai.FULL||au>ai.CIVIL_WJ){throw new RangeError("参数(keyboardType)范围必须在[0, 2]之间，当前: "+au)}if(ay===undefined||ay!==parseInt(ay,10)){throw new TypeError("参数(inputIndex)必须为整数数值")}if(ax===undefined||typeof ax!=="string"){throw new TypeError("参数(presetNumber)必须为字符串")}if(aq===undefined||aq!==parseInt(aq,10)){throw new TypeError("参数(numberType)必须为整数数值")}var ap=H(ax);var at=aq;if(ax.length>0&&aq===an.AUTO_DETECT){at=ap}var ar=an.lenOf(at);var aw=ax.length;ay=Math.min(ay,ar-1);if(aw>ar){throw new RangeError("参数(presetNumber)字符太长："+ax+"，车牌类型："+aq+"，此类型最大长度:"+ar)}var av={index:ay,number:ax,keyboardType:au,numberType:at,};var ao=R(v.layoutProvider.process(av));ao.index=av.index;ao.presetNumber=av.number;ao.keyboardType=av.keyboardType;ao.numberType=av.numberType;ao.presetNumberType=av.numberType;ao.detectedNumberType=ap;ao.numberLength=aw;ao.numberLimitLength=ar;av.keys=v.keyProvider.process(av);return v.mixiner.process(ao,av)}var h=function(){this.update=ac;this.config=v};h.$newKey=t;h.NUM_TYPES=an;h.KEY_TYPES=F;h.KEYBOARD_TYPES=ai;h.VERSION="R1.0/2017.1117/iRain(SZ)";return h})));